<%- include('../partials/header') %>

	<main class="main">
		<div class="page-header text-center" style="background-image: url('assets/images/page-header-bg.jpg')">
			<div class="container">
				<h1 class="page-title">Products<span>Shop</span></h1>
			</div>
			<!-- End .container -->
		</div>
		<!-- End .page-header -->

		<nav aria-label="breadcrumb" class="breadcrumb-nav mb-2">
			<div class="container">
				<ol class="breadcrumb">
					<li class="breadcrumb-item">
						<a href="/">Home</a>
					</li>
					<li class="breadcrumb-item"><a href="#">Shop</a></li>
					<li class="breadcrumb-item active" aria-current="page">
						Products
					</li>
				</ol>
			</div>
			<!-- End .container -->
		</nav>
		<!-- End .breadcrumb-nav -->

		<div class="page-content">
			<div class="container">
				<div class="row">
					<div class="col-lg-9">
						<div class="toolbox">
							<div class="toolbox-left">
								<div class="toolbox-info">
									<!-- Showing <span>9 of 56</span> Products -->
								</div>
								<!-- End .toolbox-info -->
							</div>
							<!-- End .toolbox-left -->

							<div class="toolbox-right">
								<div class="toolbox-sort">
									<label for="sortby">Sort by:</label>
									<div class="select-custom">
										<select id="sortDropdown" class="form-control" name="orderby"
											onchange="sortDropdownFn()">
											<option id="default" value="default" selected="selected">Default sorting
											</option>
											<option id="priceAscending" value="priceAscending">Sort by price: low to
												high</option>
											<option id="priceDescending" value="priceDescending">Sort by price: high to
												low</option>
										</select>
									</div>
								</div>




							</div>
							<!-- End .toolbox-right -->
						</div>
						<!-- End .toolbox -->
						<div class="row categoryProduct xsResponse clearfix">
							<% productData.forEach(product=> { %>
								<div class="item col-sm-3 col-lg-3 col-md-3 col-xs-6 grid-view">
									<div class="product">
										<!-- Uncomment the following lines if you want to include the "Add to Wishlist" button -->
										<!-- <a class="add-fav tooltipHere" data-toggle="tooltip" data-original-title="Add to Wishlist" data-placement="left">
											<i class="glyphicon glyphicon-heart"></i>
										</a> -->
										<div class="image">
											<a href="/productDetails/<%= product._id %>">
												<img src="/upload/<%= product.productImage1 %>" alt="img"
													class="img-responsive" />
											</a>
										</div>
										<div class="description">
											<h4 class="small-font-size">
												<a href="/productDetails/<%= product._id %>">
													<%= product.productName %>
												</a>
											</h4>
										</div>
										<div class="price">
											<span>â‚¹<%= product.productPrice %></span>
										</div>

										<% if(product.productStock <=0) { %>
											<p style="color: red;">Out of stock</p>
											<% } else { %>
												<div class="action-control">
													<a href="/cart/<%= product._id %>" class="btn btn-primary"
														onclick="addToCart()">
														<span class="add2cart"><i
																class="glyphicon glyphicon-shopping-cart"></i> Add to
															cart</span>
													</a>
												</div>
												<% } %>
									</div>
								</div>
								<% }); %>
									<!--/.item-->
						</div>


						<style>
							/* Add this CSS to your stylesheet */
							.small-font-size {
								font-size: medium;
								/* You can adjust the size based on your preference */
							}
						</style>





						<script>
							async function sortDropdownFn() {
								try {

									console.log('1');

									console.log(sortDropdown.value)
									if (sortDropdown.value == 'default') {
										return window.location.href = '/productList'
									}
									console.log('2');

									const response = await fetch('/shop/sort/' + sortDropdown.value, { method: 'GET' })
									console.log('3');

									const data = await response.json()
									console.log('3vannn');

									let sortDropdownElement = document.getElementById(`${sortDropdown.value}`)
									sortDropdownElement.setAttribute('selected', true)
									if (data.success) {
										console.log('4');

										localStorage.setItem('selectedDropdownOption', sortDropdown.value)
										window.location.href = '/productList'
									}
								} catch (error) {
									console.error(error)
								}
							}
						</script>

						<script>
							document.addEventListener('DOMContentLoaded', function () {
								const selectedDropdownOption = localStorage.getItem('selectedDropdownOption')
								if (selectedDropdownOption) {
									document.getElementById('sortDropdown').value = selectedDropdownOption
								}
							})
						</script>















						<nav aria-label="Page navigation">
							<ul class="pagination justify-content-center">
								<div class="d-flex justify-content-center py-3">
									<nav aria-label="Page navigation example">
										<ul class="pagination">
											<% for (let i=0; i < totalPagesArray.length; i++) { %>
												<li class="page-item <%= (i + 1 === currentPage) ? 'active' : '' %>">
													<a class="page-link" href="/productList/?page=<%= i + 1 %>">
														<%= i + 1 %>
													</a>
												</li>
												<% } %>
										</ul>
									</nav>
								</div>
							
							</ul>
						</nav>

					</div>
					<!-- End .col-lg-9 -->
					<aside class="col-lg-3 order-lg-first">
						<div class="sidebar sidebar-shop">
							<div class="widget widget-clean">
								<label>Filters:</label>
								<a href="/clearfilters" id="clearFiltersButton">Clean All</a>
							</div>
							<!-- End .widget widget-clean -->

							<div class="widget widget-collapsible">
								<h3 class="widget-title">
									<a data-toggle="collapse" href="#widget-1" role="button" aria-expanded="true"
										aria-controls="widget-1">
										Category
									</a>
								</h3>
								<!-- End .widget-title -->

								<div class="collapse show" id="widget-1">
									<div class="widget-body">
										<div class="filter-items filter-items-count">
											<ul class="nav nav-pills nav-stacked tree">
												<div class="panel-body">
													<% categoryData.forEach(function(category) { %>
														<% let color = (category.categoryName === selectedFilter) ? 'red' : 'black'; %>
														<li class="active dropdown-tree open-tree">
															<label>
																<a href="#" id="<%= category.categoryName %>Button"
																	onclick="redirectToCategory('<%= category.categoryName %>')"
																	class="btn"
																	style="color: <%= color %>">
																	<%= category.categoryName %>
																</a>
																
																 
																<!-- <%= category.categoryName %> -->
															</label>
														</li>
													<% }); %>
												</div>
											</ul>
											<!-- <a href="/clearfilters" id="clearFiltersButton">Clear Filters</a> -->
										</div>
										


										<script>
											function redirectToCategory(categoryName) {
												// Construct the URL for the category
												var categoryUrl = "/product/filter/category/" + encodeURIComponent(categoryName);
												// Redirect to the category URL
												window.location.href = categoryUrl;
											}
											
											
										</script>
										
										



									</div>
									<!-- End .filter-items -->
								</div>
								<!-- End .widget-body -->
							</div>
							<!-- End .collapse -->
						</div>
						<!-- End .widget -->

					
				</div>
				<!-- End .sidebar sidebar-shop -->
				</aside>
				<!-- End .col-lg-3 -->
			</div>
			<!-- End .row -->
		</div>
		</div>
		</div>



		<div class="col-lg-12 clearfix mt-4">
			<ul class="pager">
				<li class="previous pull-right"><a href="/"> <i class="fa fa-home"></i> Go to Shop </a></li>
			</ul>
		</div>



		<!-- End .container -->
		</div>
		<!-- End .page-content -->
	</main>
	<!-- End .main -->

	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>


	<script>
		// async function addToCart(id, index) {
		// 	try {
		// 		const result = await Swal.fire({
		// 			title: "Are you sure?",
		// 			text: "You won't be able to revert this!",
		// 			icon: "warning",
		// 			showCancelButton: true,
		// 			confirmButtonColor: "#3085d6",
		// 			cancelButtonColor: "#d33",
		// 			confirmButtonText: "Yes, add to cart!"
		// 		});

		// 		if (result.isConfirmed) {

		// 			Swal.fire({
		// 				title: "Added to Cart!",
		// 				icon: "success"
		// 			});
		// 		}
		// 	} catch (error) {
		// 		console.error(error);
		// 	}
		// }




		function addToCart() {

			Swal.fire({
				icon: 'success',
				title: 'Item Added to Cart',
				showConfirmButton: false,
				timer: 1500
			});
		}


	</script>






	<%- include('../partials/footer') %>